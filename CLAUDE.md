# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Viwo (Virtual Worktrees) is a CLI tool for managing isolated development environments using Git worktrees and Docker containers. It helps developers run AI agents safely by providing containerized workspaces with filesystem isolation.

## Development Commands

### Build and Development

- `bun run build` - Compile TypeScript to JavaScript in `dist/` directory
- `bun run build:watch` - Watch mode compilation for development
- `bun run dev` - Run CLI directly from source (equivalent to `bun src/cli.ts`)

### Code Quality

- `bun run format` - Format code using Prettier
- `bun run format:check` - Check code formatting without making changes
- No tests are currently configured (test script exits with error)

### Package Management

- Uses Bun as the primary runtime and package manager
- `bun install` to install dependencies

## Architecture

### Core Components

**CLI (`src/cli.ts`)**: Main entry point with Commander.js-based commands:

- `list` - Show all worktrees with status
- `add <name> [branch]` - Create new git worktree
- `create <worktree-id> [branch]` - Create worktree with optional container
- `start <worktree-id>` - Start containers for existing worktree
- `stop <worktree-id>` - Stop worktree containers
- `clean <worktree-id>` - Remove worktree and containers

**Core Logic (`src/core.ts`)**: Main business logic for listing and managing worktrees:

- `listWorktrees()` - Discovers git worktrees and enriches with container status
- `getWorktreeStatus()` - Combines worktree and container information

**Worktree Manager (`src/worktree-manager.ts`)**: Git worktree operations

- Handles git worktree creation, removal, and listing
- Manages worktree directory structure

**Container Manager (`src/container-manager.ts`)**: Docker container operations

- Creates development containers with mounted volumes
- Manages container lifecycle (start, stop, remove)

**Schemas (`src/schemas.ts`)**: Zod-based type definitions

- `WorktreeSchema` - Main worktree data structure
- Ensures type safety across the application

**Preflight Checks (`src/preflight-checks.ts`)**: System validation

- Verifies Docker and Git availability before operations

### Key Design Patterns

- Uses ESM modules throughout (`"type": "module"` in package.json)
- Zod schemas for runtime type validation and TypeScript integration
- Bun's `$` template literal for shell command execution
- Commander.js for CLI structure with proper error handling
- All CLI commands run preflight checks before execution

### Dependencies

**Runtime**: commander (CLI), zod (schemas)
**Dev**: TypeScript, Prettier, Husky (git hooks), lint-staged

## File Structure

- `src/` - Source TypeScript files
- `dist/` - Compiled JavaScript output (generated by `tsc`)
- Git worktrees are created in parent directory (`..`) by default
- Containers mount worktree paths as `/workspace`

## Development Notes

- TypeScript compiled to ES2022 with declarations
- Code formatting enforced via Prettier with 4-space indentation
- Git hooks configured via Husky for pre-commit formatting
- CLI expects Docker daemon to be running for container operations
- After each work instance, make a quick note in [PROGRESS.md](./PROGRESS.md) to recap.
-
